<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Auto-scroll i mobilram (stegvis + fade reset)</title>
<style>
  :root{
    --phone-w: 420px;
    --phone-h: 880px;
    --screen-w: 390px;
    --screen-h: 600px; /* lagom för tydlig scroll; justera vid behov */
    --radius-phone: 60px;
    --radius-screen: 40px;
    --bg: #eceff1;
    --chrome-shadow: rgba(0,0,0,.5);
  }
  * { box-sizing: border-box; }
  html, body { height: 100%; }
  body{
    margin:0; display:grid; place-items:center; height:100%;
    background: var(--bg);
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
  }

  /* Telefonkropp */
  .phone{
    position:relative;
    width:var(--phone-w); height:var(--phone-h);
    background:#111; border-radius:var(--radius-phone);
    box-shadow:0 24px 60px var(--chrome-shadow), inset 0 0 0 2px #222;
    overflow:hidden;
  }
  /* Sidobevels */
  .phone::before, .phone::after{
    content:""; position:absolute; top:0; bottom:0; width:6px; pointer-events:none;
    background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.35));
  }
  .phone::before{ left:0; }
  .phone::after{ right:0; }

  /* “Knappar” */
  .btn{
    position:absolute; left:-2px; width:6px; border-radius:3px; background:#2a2a2a;
    box-shadow: inset 0 0 4px rgba(0,0,0,.6);
  }
  .btn.volup{ top:160px; height:48px; }
  .btn.voldn{ top:220px; height:48px; }
  .btn.silent{ top:120px; height:30px; }

  /* Notch + högtalare + kamera */
  .notch{
    position:absolute; top:10px; left:50%; transform:translateX(-50%);
    width:160px; height:26px; background:#000; border-radius:0 0 14px 14px;
    box-shadow:0 2px 6px rgba(0,0,0,.4); z-index:2;
  }
  .speaker{
    position:absolute; top:6px; left:50%; transform:translateX(-50%);
    width:64px; height:6px; background:#1a1a1a; border-radius:3px;
  }
  .cam{
    position:absolute; top:5px; right:18px; width:9px; height:9px; border-radius:50%;
    background: radial-gradient(circle at 30% 30%, #2a6cff, #0a0a0a 60%);
    box-shadow:0 0 4px rgba(42,108,255,.6);
  }

  /* Skärmen */
  .screen{
    position:absolute; top:40px; left:15px;
    width:var(--screen-w); height:var(--screen-h);
    border-radius:var(--radius-screen); overflow:hidden; background:#fff;
    box-shadow: inset 0 0 40px rgba(0,0,0,.15);
  }

  /* Långa bilden */
  .longshot{
    width:100%; height:auto; display:block;
    transform: translateY(0);
    opacity: 1;
    will-change: transform, opacity;
    /* övergångar sätts i JS */
  }

  /* Skala ner om inbäddningen är smal */
  .scale-wrap { transform-origin: top left; }
  @media (max-width: 460px){ .scale-wrap{ transform: scale(0.9); } }
  @media (max-width: 420px){ .scale-wrap{ transform: scale(0.8); } }
  @media (max-width: 380px){ .scale-wrap{ transform: scale(0.72); } }
</style>
</head>
<body>
  <div class="scale-wrap">
    <div class="phone" role="img" aria-label="Telefonram med auto-scrollande förhandsvisning">
      <div class="btn silent"></div>
      <div class="btn volup"></div>
      <div class="btn voldn"></div>

      <div class="notch">
        <div class="speaker"></div>
        <div class="cam"></div>
      </div>

      <div class="screen">
        <img id="longshot" class="longshot"
             src="https://sleo1.github.io/scroll-demo/startsida2024-2.jpg"
             alt="Lång sida">
      </div>
    </div>
  </div>

<script>
(function(){
  // === Parametrar för “manuell scroll”-känsla ===
  const STEP_DURATION = 2000;   // ms per scrollsteg (~2 s)
  const STEP_GAP      = 200;    // ms paus mellan steg (liten andhämtning)
  const TOP_PAUSE     = 800;    // ms paus innan första scrollen
  const BOTTOM_PAUSE  = 800;    // ms paus när botten nås
  const FADE_OUT_DUR  = 600;    // ms fade-out i botten innan reset
  const FADE_IN_DUR   = 400;    // ms fade-in efter reset

  const img   = document.getElementById('longshot');
  const screen= document.querySelector('.screen');

  let running = false;
  let pendingResize = false;

  function sleep(ms){ return new Promise(r => setTimeout(r, ms)); }

  function setTransform(y){
    img.style.transform = `translateY(${-Math.max(0, Math.round(y))}px)`;
  }

  function transition(props, dur, easing='ease'){
    img.style.transition = props.map(p => `${p} ${dur}ms ${easing}`).join(', ');
  }

  function clearTransition(){
    img.style.transition = 'none';
  }

  function calcDelta(){
    if(!img.naturalWidth || !img.naturalHeight) return 0;
    const scale = screen.clientWidth / img.naturalWidth;
    const imgHeight = img.naturalHeight * scale;
    const visHeight = screen.clientHeight;
    return Math.max(0, imgHeight - visHeight);
  }

  async function animateStep(fromY, toY){
    clearTransition();
    // sätt startposition direkt
    setTransform(fromY);
    // animera till mål
    await sleep(20); // låt layouten hinna applicera startläget
    transition(['transform'], STEP_DURATION, 'ease-in-out');
    setTransform(toY);
    await sleep(STEP_DURATION);
    clearTransition();
  }

  async function fadeOutResetFadeIn(){
    // fade out
    clearTransition();
    await sleep(20);
    transition(['opacity'], FADE_OUT_DUR, 'ease');
    img.style.opacity = '0';
    await sleep(FADE_OUT_DUR);

    // reset position direkt (osynlig)
    clearTransition();
    setTransform(0);

    // fade in
    await sleep(20);
    transition(['opacity'], FADE_IN_DUR, 'ease');
    img.style.opacity = '1';
    await sleep(FADE_IN_DUR);
    clearTransition();
  }

  async function runLoop(){
    if(running) return;
    running = true;

    while(running){
      // säkerställ dimensioner
      const delta = calcDelta();

      if(delta <= 0){
        // inget att scrolla – vänta lite och försök igen (kan ändras vid resize)
        await sleep(1000);
        continue;
      }

      // stegstorlek ≈ skärmhöjd minus lite marginal så det känns som “användarsvep”
      const stepSize = Math.max(120, screen.clientHeight * 0.85);
      let pos = 0;

      // liten paus i toppen
      await sleep(TOP_PAUSE);

      // scrolla i steg
      while(pos < delta - 1){
        const next = Math.min(delta, pos + stepSize);
        await animateStep(pos, next);
        pos = next;
        await sleep(STEP_GAP);
        if(pendingResize){ break; }
      }

      if(pendingResize){ pendingResize = false; continue; }

      // paus i botten, sedan fade reset
      await sleep(BOTTOM_PAUSE);
      await fadeOutResetFadeIn();

      // loop fortsätter automatiskt
    }
  }

  async function ready(){
    try { if (img.decode) await img.decode(); } catch(e){}
    img.style.opacity = '1';
    setTransform(0);
    runLoop();
  }

  // Reagera på bildladdning och resize
  if (img.complete && img.naturalWidth) ready();
  else img.addEventListener('load', ready, { once:true });

  window.addEventListener('resize', () => {
    // markera att vi behöver beräkna om; avbryt pågående steg efter current cycle
    pendingResize = true;
  }, { passive:true });

})();
</script>
</body>
</html>
