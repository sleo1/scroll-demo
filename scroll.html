<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Vit mobil 300×534 – tunn, låg skugga & auto-höjd</title>
<style>
  :root{
    --phone-w: 300px;
    --phone-h: 534px;
    --screen-lr: 8px;
    --screen-top: 24px;
    --screen-h: 480px;
    --radius-phone: 28px;
    --radius-screen: 20px;
  }

  * { box-sizing: border-box; }
  html, body { height: 100%; }
  body{
    margin:0;
    background:transparent; /* alltid transparent */
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    display:grid; place-items:center;
    overflow: hidden; /* inga inre scrollbars i iframen */
  }

  .stage{
    display:grid;
    place-items:center;
    padding-bottom: 30px; /* lite luft under för skuggan (sänkt från 60px) */
    position: relative;
  }

  .phone{
    position:relative;
    width:var(--phone-w);
    height:var(--phone-h);
    background:#fff;
    border-radius: var(--radius-phone);
    box-shadow: inset 0 0 0 1px #e0e0e0;
    overflow:hidden;
    z-index:2;
  }

  /* Tunn, låg ellips-skugga nära botten (mer realistisk) */
  /*.shadow{
    position:absolute;
    bottom:8px;                        /* närmare botten */
    left:50%;
    transform:translateX(-50%);
    width: 260px;                      /* lite smalare än telefonens 300px bredd */
    height: 18px;                      /* lägre/tunnare */
    background: radial-gradient(ellipse at center,
                rgba(0,0,0,0.15) 0%,
                rgba(0,0,0,0) 80%);
    filter: blur(10px);                /* mjukare */
    z-index:1;
    pointer-events:none;
  }*/

  .notch{
    position:absolute; top:6px; left:50%; transform:translateX(-50%);
    width:90px; height:14px; background:#eee;
    border-radius:0 0 8px 8px;
    box-shadow: inset 0 0 2px rgba(0,0,0,.12);
    z-index:2;
  }

  .screen{
    position:absolute;
    top: var(--screen-top);
    left: var(--screen-lr);
    width: calc(var(--phone-w) - var(--screen-lr) * 2);
    height: var(--screen-h);
    border-radius: var(--radius-screen);
    overflow:hidden;
    background:#fff;
    box-shadow: inset 0 0 18px rgba(0,0,0,.10);
  }

  .longshot{
    width:100%;
    height:auto;
    display:block;
    transform: translateY(0);
    opacity: 1;
    will-change: transform, opacity;
  }
</style>
</head>
<body>
  <div class="stage" id="stage">
    <div class="phone">
      <div class="notch"></div>
      <div class="screen" id="screen">
        <img id="longshot" class="longshot"
             src="https://sleo1.github.io/scroll-demo/startsida2024-2.jpg"
             alt="Lång sida">
      </div>
    </div>
    <div class="shadow"></div>
  </div>

<script>
(() => {
  // === Stegvis auto-scroll (4 s per steg) ===
  const STEP_DURATION = 4000;
  const STEP_GAP      = 200;
  const TOP_PAUSE     = 600;
  const BOTTOM_PAUSE  = 600;
  const FADE_OUT_DUR  = 500;
  const FADE_IN_DUR   = 350;

  const img = document.getElementById('longshot');
  const screen = document.getElementById('screen');

  let running = false;

  const sleep = (ms)=>new Promise(r=>setTimeout(r,ms));
  const setY = (y)=>{ img.style.transform = `translateY(${-Math.max(0, Math.round(y))}px)`; };
  const transition = (props, dur, easing='ease') => { img.style.transition = props.map(p=>`${p} ${dur}ms ${easing}`).join(', '); };
  const clearTransition = ()=>{ img.style.transition = 'none'; };

  function deltaPx(){
    if(!img.naturalWidth || !img.naturalHeight) return 0;
    const scale   = screen.clientWidth / img.naturalWidth;
    const imgH    = img.naturalHeight * scale;
    return Math.max(0, imgH - screen.clientHeight);
  }

  async function animateStep(fromY, toY){
    clearTransition(); setY(fromY);
    await sleep(20);
    transition(['transform'], STEP_DURATION, 'ease-in-out');
    setY(toY);
    await sleep(STEP_DURATION);
    clearTransition();
    postSize(); // uppdatera höjd efter varje steg
  }

  async function fadeReset(){
    clearTransition(); await sleep(20);
    transition(['opacity'], FADE_OUT_DUR, 'ease'); img.style.opacity = '0';
    await sleep(FADE_OUT_DUR);
    clearTransition(); setY(0);
    await sleep(20);
    transition(['opacity'], FADE_IN_DUR, 'ease'); img.style.opacity = '1';
    await sleep(FADE_IN_DUR);
    clearTransition();
    postSize(); // uppdatera efter reset
  }

  async function loop(){
    if(running) return; running = true;
    while(running){
      const delta = deltaPx();
      if(delta <= 0){ img.style.opacity='1'; setY(0); await sleep(1000); postSize(); continue; }
      const stepSize = Math.max(120, screen.clientHeight * 0.85);
      let pos = 0;
      await sleep(TOP_PAUSE);
      while(pos < delta - 1){
        const next = Math.min(delta, pos + stepSize);
        await animateStep(pos, next);
        pos = next;
        await sleep(STEP_GAP);
      }
      await sleep(BOTTOM_PAUSE);
      await fadeReset();
    }
  }

  async function ready(){
    try{ if(img.decode) await img.decode(); }catch(e){}
    img.style.opacity='1'; setY(0);
    postSize(); // initialt
    loop();
  }

  if (img.complete && img.naturalWidth) ready();
  else img.addEventListener('load', ready, { once:true });

  // === Auto-höjd till föräldersidan (Google Sites) ===
  function postSize(){
    const h = document.documentElement.scrollHeight;
    parent.postMessage({ scrollDemoHeight: h }, "*");
  }
  window.addEventListener("load", postSize);
  window.addEventListener("resize", postSize);
  setInterval(postSize, 1500); // säkerställ uppdatering
})();
</script>
</body>
</html>
